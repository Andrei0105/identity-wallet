<!DOCTYPE html>
<html>

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://unpkg.com/blockstack@19.2.1/dist/blockstack.js"
        integrity="sha384-+qYCYoUGzsMLAzHm80c4DyhbWgHBBb2N0RFqsg7Lws5ljtBtj/IwpgxZkiR7j7lp"
        crossorigin="anonymous"></script>
    <script>
        var url = new URL(window.location.href);
        var ar = url.searchParams.get("authResponse");

        if (ar) {
            console.log(ar);
        }
        window.parent.postMessage({ auth_response: ar }, '*');

    </script>
</head>

<body>
    <input name="name" type="text" id="name">
    <input name="country" type="text" id="country">

    <button type="button" id='static_login_btn'>Login with IW</button>
    <button type="button" id='static_login_btn_blockstack'>Login with Blockstack</button>
    <button type="button" id='signin-button'>Inpage blockstack test</button>
    <button type="button" id='aries-connect-button'>Aries connect</button>
    <script>

        function getInvitation() {
            // generate a connection invitation on the page's agent
            // this should be managed by the page
            var jqXHR = $.ajax({
                type: 'POST',
                url: 'http://localhost:5050/connections/create-invitation',
                async: false
            });
            return JSON.stringify(jqXHR.responseJSON.invitation);
        }

        function useIW() {
            if (typeof iw !== 'undefined') {
                $(document).ready(function () {
                    $('#static_login_btn').click({ simple: ['name', 'country'], verified: ['Example', 'Diploma'] },
                        iw.requestUportClaims);
                });
                $(document).ready(function () {
                    $('#static_login_btn_blockstack').click({ simple: ['name', 'country'], verified: ['Example', 'Diploma'] },
                        iw.requestBlockstackClaims);
                });
                $(document).ready(function () {
                    $('#aries-connect-button').click({ invitation: getInvitation() },
                        iw.initiateAriesConnection);
                });
                setTimeout(checkClaims, 500);
            }
            else {
                setTimeout(useIW, 50);
            }
        }
        setTimeout(useIW, 50);

        function checkClaims() {
            if (typeof iw.requestedClaims !== 'undefined') {
                console.log('PAGE:', 'Received claims:', iw.requestedClaims);
            }
            else {
                setTimeout(checkClaims, 500);
            }
        }

        function useBlockstack() {
            if (typeof window.blockstack !== "undefined") {
                authReq = blockstack.makeAuthRequest();
                document.getElementById('signin-button').addEventListener('click', function () {
                    console.log('here')
                    blockstack.redirectToSignInWithAuthRequest(authReq);
                });

            }
        }

        setTimeout(useBlockstack, 1000);
    </script>

</body>

</html>