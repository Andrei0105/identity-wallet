# Testing Aries Agents
This is a guide for setting up 2 Aries Cloud Agents connected to a local Hyperledger Indy Pool to use as test environment. Connecting the 2 agents, creating DIDs, schemas and credential definitions, issuing credentials and presenting proofs is also demonstrated.\
Requirements: libindy, indy-cli, aca-py.
## Starting the Indy Local Pool
Clone the indy-sdk repo: https://github.com/hyperledger/indy-sdk \
Run the following command to create a 4 node cluster:
```
docker build -f ci/indy-pool.dockerfile -t indy_pool .
```
Start the container:
```
docker run -itd -p 9701-9708:9701-9708 indy_pool
```
Save the following genesis file (eg: genesis-pool-config):
```
{"reqSignature":{},"txn":{"data":{"data":{"alias":"Node1","blskey":"4N8aUNHSgjQVgkpm8nhNEfDf6txHznoYREg9kirmJrkivgL4oSEimFF6nsQ6M41QvhM2Z33nves5vfSn9n1UwNFJBYtWVnHYMATn76vLuL3zU88KyeAYcHfsih3He6UHcXDxcaecHVz6jhCYz1P2UZn2bDVruL5wXpehgBfBaLKm3Ba","blskey_pop":"RahHYiCvoNCtPTrVtP7nMC5eTYrsUA8WjXbdhNc8debh1agE9bGiJxWBXYNFbnJXoXhWFMvyqhqhRoq737YQemH5ik9oL7R4NTTCz2LEZhkgLJzB3QRQqJyBNyv7acbdHrAT8nQ9UkLbaVL9NBpnWXBTw4LEMePaSHEw66RzPNdAX1","client_ip":"127.0.0.1","client_port":9702,"node_ip":"127.0.0.1","node_port":9701,"services":["VALIDATOR"]},"dest":"Gw6pDLhcBcoQesN72qfotTgFa7cbuqZpkX3Xo6pLhPhv"},"metadata":{"from":"Th7MpTaRZVRYnPiabds81Y"},"type":"0"},"txnMetadata":{"seqNo":1,"txnId":"fea82e10e894419fe2bea7d96296a6d46f50f93f9eeda954ec461b2ed2950b62"},"ver":"1"}
{"reqSignature":{},"txn":{"data":{"data":{"alias":"Node2","blskey":"37rAPpXVoxzKhz7d9gkUe52XuXryuLXoM6P6LbWDB7LSbG62Lsb33sfG7zqS8TK1MXwuCHj1FKNzVpsnafmqLG1vXN88rt38mNFs9TENzm4QHdBzsvCuoBnPH7rpYYDo9DZNJePaDvRvqJKByCabubJz3XXKbEeshzpz4Ma5QYpJqjk","blskey_pop":"Qr658mWZ2YC8JXGXwMDQTzuZCWF7NK9EwxphGmcBvCh6ybUuLxbG65nsX4JvD4SPNtkJ2w9ug1yLTj6fgmuDg41TgECXjLCij3RMsV8CwewBVgVN67wsA45DFWvqvLtu4rjNnE9JbdFTc1Z4WCPA3Xan44K1HoHAq9EVeaRYs8zoF5","client_ip":"127.0.0.1","client_port":9704,"node_ip":"127.0.0.1","node_port":9703,"services":["VALIDATOR"]},"dest":"8ECVSk179mjsjKRLWiQtssMLgp6EPhWXtaYyStWPSGAb"},"metadata":{"from":"EbP4aYNeTHL6q385GuVpRV"},"type":"0"},"txnMetadata":{"seqNo":2,"txnId":"1ac8aece2a18ced660fef8694b61aac3af08ba875ce3026a160acbc3a3af35fc"},"ver":"1"}
{"reqSignature":{},"txn":{"data":{"data":{"alias":"Node3","blskey":"3WFpdbg7C5cnLYZwFZevJqhubkFALBfCBBok15GdrKMUhUjGsk3jV6QKj6MZgEubF7oqCafxNdkm7eswgA4sdKTRc82tLGzZBd6vNqU8dupzup6uYUf32KTHTPQbuUM8Yk4QFXjEf2Usu2TJcNkdgpyeUSX42u5LqdDDpNSWUK5deC5","blskey_pop":"QwDeb2CkNSx6r8QC8vGQK3GRv7Yndn84TGNijX8YXHPiagXajyfTjoR87rXUu4G4QLk2cF8NNyqWiYMus1623dELWwx57rLCFqGh7N4ZRbGDRP4fnVcaKg1BcUxQ866Ven4gw8y4N56S5HzxXNBZtLYmhGHvDtk6PFkFwCvxYrNYjh","client_ip":"127.0.0.1","client_port":9706,"node_ip":"127.0.0.1","node_port":9705,"services":["VALIDATOR"]},"dest":"DKVxG2fXXTU8yT5N7hGEbXB3dfdAnYv1JczDUHpmDxya"},"metadata":{"from":"4cU41vWW82ArfxJxHkzXPG"},"type":"0"},"txnMetadata":{"seqNo":3,"txnId":"7e9f355dffa78ed24668f0e0e369fd8c224076571c51e2ea8be5f26479edebe4"},"ver":"1"}
{"reqSignature":{},"txn":{"data":{"data":{"alias":"Node4","blskey":"2zN3bHM1m4rLz54MJHYSwvqzPchYp8jkHswveCLAEJVcX6Mm1wHQD1SkPYMzUDTZvWvhuE6VNAkK3KxVeEmsanSmvjVkReDeBEMxeDaayjcZjFGPydyey1qxBHmTvAnBKoPydvuTAqx5f7YNNRAdeLmUi99gERUU7TD8KfAa6MpQ9bw","blskey_pop":"RPLagxaR5xdimFzwmzYnz4ZhWtYQEj8iR5ZU53T2gitPCyCHQneUn2Huc4oeLd2B2HzkGnjAff4hWTJT6C7qHYB1Mv2wU5iHHGFWkhnTX9WsEAbunJCV2qcaXScKj4tTfvdDKfLiVuU2av6hbsMztirRze7LvYBkRHV3tGwyCptsrP","client_ip":"127.0.0.1","client_port":9708,"node_ip":"127.0.0.1","node_port":9707,"services":["VALIDATOR"]},"dest":"4PS3EDQ3dW1tci1Bp6543CfuuebjFrg36kLAUcskGfaA"},"metadata":{"from":"TWwCRQRZ2ZHMJFn9TzLp7W"},"type":"0"},"txnMetadata":{"seqNo":4,"txnId":"aa5e817d7cc626170eca175822029339a444eb0ee8f0bd20d3b0b76e566fb008"},"ver":"1"}
```
Open up the Indy cli by running ```indy-cli``` in a terminal window.\
Use the indy-cli to create a local-pool:
```
pool create indy_pool gen_txn_file=/path/to/genesis/file
```
If, needed the pool can be managed from the CLI by connecting to it using:
```
pool connect indy-pool
```
## Starting the Indy Ledger Browser
The Ledger Browser enables registering DIDs on the ledger and keeping track of transactions.\
Clone the von-network repo: https://github.com/bcgov/von-network \
Run in the root von directory:
```
sudo GENESIS_FILE=/path/to/genesis/file PORT=9000 REGISTER_NEW_DIDS=true python3 -m server.server
```
The Ledger Browser is now available at localhost:9000
## Starting the Aries Agents
Run in two separate terminal windows:
```
aca-py start -it http 0.0.0.0 9010 -it ws 0.0.0.0 9011 -ot ws -ot http --log-config ~/Desktop/Desktop/log_set.ini --admin 0.0.0.0 5050 --admin-insecure-mode --pool-name indy_pool --log-level debug --genesis-url http://localhost:9000/genesis --auto-accept-invites --auto-accept-requests --public-invites --auto-ping-connection --auto-respond-messages --auto-respond-credential-offer --auto-respond-presentation-request --auto-verify-presentation --label aca1 -e http://0.0.0.0:9010 --wallet-name w_aca1_cli --wallet-key w_aca1_cli --wallet-type indy
```
```
aca-py start -it http 0.0.0.0 9020 -it ws 0.0.0.0 9021 -ot ws -ot http --log-config ~/Desktop/Desktop/log_set.ini --admin 0.0.0.0 5051 --admin-insecure-mode --pool-name local-pool --log-level debug --genesis-url http://localhost:9000/genesis --auto-accept-invites --auto-accept-requests --public-invites --auto-ping-connection --auto-respond-messages --auto-respond-credential-offer --auto-respond-presentation-request --auto-verify-presentation --label aca2 -e http://0.0.0.0:9020 --wallet-name w_aca2_cli --wallet-key w_aca2_cli --wallet-type indy
```
From the admin interfaces of each agent different types of requests can be generated. The interface for agent 1 is available at localhost:5050 and for agent 2 at localhost:5051.
## Connecting the two agents
No public DIDs are required for a connection.
In the interface for Agent1, issue a /connections/create-invitation request. From it's response, copy the invitation object which should look like this:
```
{
    "@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/connections/1.0/invitation",
    "@id": "acedeb22-9c4e-44f5-af36-1d9359e0f247",
    "recipientKeys": [
      "EPDG8EYcQperKNEnpZy8NH237B19iDvcUXaRaeJWNeUp"
    ],
    "label": "aca1",
    "serviceEndpoint": "http://0.0.0.0:9010"
}
```
In the interface for Agent2, issue a /connections/receive-invitation request with the generated invitation object as the body.\
The response should look like this:
```
{
  "accept": "auto",
  "state": "request",
  "updated_at": "2019-08-08 16:03:39.709687Z",
  "initiator": "external",
  "created_at": "2019-08-08 16:03:39.500010Z",
  "invitation_key": "EPDG8EYcQperKNEnpZy8NH237B19iDvcUXaRaeJWNeUp",
  "their_label": "aca1",
  "request_id": "4f820e61-ea64-4d1e-90d7-6bf0d71dfaad",
  "routing_state": "none",
  "connection_id": "c4513b1f-0f6a-41d4-9695-8e035ac42c85",
  "my_did": "MnCBzULyJr7NLEmbW9PnUE"
}
```
## Registering a public DID
Next, Agent1 has to register a schema and a credential definition on the ledger. To do this, a public DID is needed.\
On Agent1, issue a /wallet/did/create request.
The response should look like this:
```
{
  "result": {
    "did": "UDyb3ptnV9wwi95no6MHvU",
    "verkey": "FqbXu3VbvL9GNgvWuRmkcgiFv3bgUtnZ55hCgDRGmANR",
    "public": "false"
  }
}
```
Now navigate to the Ledger Browser at localhost:9000 and using the did and verkey, register the DID on the ledger.\
Then, from Agent1 issue a POST /wallet/did/public request.
To test that the DID is regitered use the GET /wallet/did/public which should return the following:
```
{
  "result": {
    "did": "UDyb3ptnV9wwi95no6MHvU",
    "verkey": "FqbXu3VbvL9GNgvWuRmkcgiFv3bgUtnZ55hCgDRGmANR",
    "public": "true"
  }
}
```
## Creating a Credential Schema
On Agent1, use the POST /schemas request to send a schema to the ledger. As the body, use the following:
```
{
  "schema_version": "0.0.1",
  "attributes": [
    "name",
    "age"
  ],
  "schema_name": "person schema"
}
```
The response should look like this:
```
{
  "schema_id": "UDyb3ptnV9wwi95no6MHvU:2:person schema:0.0.1"
}
```
## Creating a Credential Definition
On Agent1, use POST /credential-definitions to send a credential definition to the ledger. As body, use the response from POST /schemas. The response should look like this:
```
{
  "credential_definition_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:21:default"
}
```
## Issuing a Credential
On Agent1, use the POST /credential_exchange/send request. In the body, complete the credential_definition_id and the connection_id with the values generated previously (on Agent1) and the credential_values as in the following:
```
{
  "credential_values": {"name": "Alice Smith", "age": "24"},
  "credential_definition_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:21:default",
  "connection_id": "fb377829-1b7a-4c83-85b6-8a3dbf6e2051"
}
```
On Agent2, use GET /credential_exchange to check if the exchange request was received. The output should look like this:
```
{
  "results": [
    {
      "credential_definition_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:21:default",
      "initiator": "external",
      "created_at": "2019-08-08 16:51:26.932512Z",
      "connection_id": "c4513b1f-0f6a-41d4-9695-8e035ac42c85",
      "raw_credential": {
        "schema_id": "UDyb3ptnV9wwi95no6MHvU:2:person schema:0.0.1",
        "cred_def_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:21:default",
        "rev_reg_id": null,
        "values": {
          "age": {
            "raw": "24",
            "encoded": "24"
          },
          "name": {
            "raw": "Alice Smith",
            "encoded": "62816810226936654797779705000772968058283780124309077049681734835796332704413"
          }
        },
        "signature": {
          "p_credential": {
            "m_2": "70227615207778282915390946358221310153086046867331598224929692702647508060776",
            "a": "85679013927393718435818365905726118518072784893531950304675239400484443346251462829835443730576077280360323233581642454369962852405161378825909562503194221144535837155100955120870530508571763146064925030930357211149486147371417232918573663441697431272650998916197100854600866071448514530613141871894540384817619557658632118124412119680459413413032710841800657492673839490166508370496681104588607887255275477121031826606296672200903277879574988253503897163537650384342758852401431469857010341772046790345514492388776276930286899622951002589168303478328021215931159389235460488546911325978836139635521266849166625316940",
            "e": "259344723055062059907025491480697571938277889515152306249728583105665800713306759149981690559193987143012367913206299323899696942213235956742929824000627020999348110416456088236253",
            "v": "7048848370171115788807749901277626009121387798757000296306566303055563129212226366347607035656521929083199549078888344352882310788255998278117529536211133711356935031658935728738638246358371080798951004953829111265651134602884461064011305358148618712404204213109483942229520116718795836964413414276944729592870810218485995706945883396320933131976698405561309366762344717729015524253205734673340189119612416250482617478936943936705736093756866853465016634579907563541108136606449766854540879198206350708935130306277591896950547779121450556504906848111959768940140803407737953881938539754360823538890037851681351526701822142787141733519436496987244771472904516322003529662098954666635967238319260308738406208202145861454507626740356698591958393654582850401260060857437212286180432417901147550812889962012912840345230979338"
          },
          "r_credential": null
        },
        "signature_correctness_proof": {
          "se": "12408944345424568758592716385474863353671516966328870945972264492354811075760295460974172030020226136840042714479272662878313289019068215152645988895535502886882125739255535609849034013770637017083921011530845253758644876185656333557111011685166369834737991721080164532967180022087363629624814298002574977277516106855657483074776858441982148718123769141248118081254500869903417681550017744056604025712612473210967370308073899823053988205317567318349858942629528066687317007780416873780270225682600388402141684838786083791564225156471392923113459280727364695470614247212989781040522729175760108451489596712886871920396",
          "c": "66393587881277659574021866596429793467828478454558582919616799530716105267953"
        },
        "rev_reg": null,
        "witness": null
      },
      "updated_at": "2019-08-08 16:51:27.598412Z",
      "schema_id": "UDyb3ptnV9wwi95no6MHvU:2:person schema:0.0.1",
      "credential_request_metadata": {
        "master_secret_blinding_data": {
          "v_prime": "3787991098844397155250682447618993239096606270747594813407647894642985403704533844206971043441133340617678515373290274239173953161806309661300899576768208614580299825197350978787058592904236774241401327406663855792696653860007018960178564177833306308080838797534027090714628074675440708251994864954082722979910019874198883759052045117441183943486024299004281367407434562551388635790663530148103704825845385754517812678228530979148108148222895527320364417285614366409548186640307305971758464547944653789272311652738025540014138638791322118017878451506322271713261968822498632217449490915639695320646592758844266082086423910543706509553680740",
          "vr_prime": null
        },
        "nonce": "310616660542479610758957",
        "master_secret_name": "w_aca2_cli"
      },
      "auto_issue": false,
      "state": "credential_received",
      "credential_exchange_id": "fe6cd5a1-72bc-4599-8252-cf9249c66203",
      "thread_id": "bfdb30de-f9e8-4cb2-b162-94b1501732c8",
      "credential_request": {
        "prover_did": "MnCBzULyJr7NLEmbW9PnUE",
        "cred_def_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:21:default",
        "blinded_ms": {
          "u": "10791035157968612654968242884010484581056834698096893527963360594504071863041506402069922924734617425714758629999225817210500916488964258882875493500003408156927206331256179322850305263970113397881988663046847594708517936023092639830651120987713943985656238812466755477786183290103606150790346577312739301495498667217736514123361297733838464172024622447828664961711512387871292191401062617719073347024103705023858748526508126996028972802657285810660506760046771386968240019669125388735432506917262684522495667050318914861654102517896923536724949188320360492056989061295678990829767352669925484238533012328816233942772",
          "ur": null,
          "hidden_attributes": [
            "master_secret"
          ],
          "committed_attributes": {}
        },
        "blinded_ms_correctness_proof": {
          "c": "17289881482489322214031352601497333769969070400487815479055133871484934824485",
          "v_dash_cap": "65493917155744122165239850151850147695311151304562722518745229159453598038250837074132542080880065559537789923570782817315636215551708014586868235015982659949238406973090255936726626908309195515580984091569018895719139827629077688903727367166925088100899857581845651387775941406640561878770024500938324418899601762787142756307573449798094727244821336832260375233167204346471079991788274049337015536378085197253987945646666247223081673976444081763080036456253723212310864899264814278643411983037974130691349630507517704806424733687994074120562383994663868556516763666586725955935168245638163028353416275850713375458900237095401305370092399297009245592751135568602579086970521573856524347723304388861903094111053632401",
          "m_caps": {
            "master_secret": "14871527047310746298500259197357266811938124825654883641154234420145825888669646257774440520508756424466614890915833756365598583740598021811206774786575471029366991449717846803307"
          },
          "r_caps": {}
        },
        "nonce": "310616660542479610758957"
      },
      "credential_offer": {
        "schema_id": "UDyb3ptnV9wwi95no6MHvU:2:person schema:0.0.1",
        "cred_def_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:21:default",
        "key_correctness_proof": {
          "c": "5633244417270010081345610806094166299939390978982933673588774313945343602132",
          "xz_cap": "16707885381309482944544874586146235979669547483845584032549519044853752063550700898900379553244760521623187063186472251984666858865432636269208349118145151404137776137670175367340399679772867027055646528433240850386517786884497938933339182965732716152759587404299198734805019272537016918391351894566128309090145539336112689553605264867485763602565630708772284958265164497285013317826416107586880443287477714727102128806170807958099123266363299806101307840500984097709415495233231124577970425416742314946536593274654677576261685216888059200637812757180891897360020044920391052614858769292218658775977512682071796963944268432752380151652955324135701582400576591039772868480162585336423937119849",
          "xr_cap": [
            [
              "name",
              "53299455418379044509619153273198729379505304496867260195060222634784002989346869246976915909820246105029981770854102416732654918031793879374046499656124872138285005606223328994750537446768077172668446865992412557088358951505919417828099204698833771464559738541211693257835432469484254641469911902583654062063197175694157870712190053028837141614565897392762433610322320954527771632528095732788300479826387221448666163324276092977290084592279493100359585285445451468304395118195128352730791353611981931766218329785138932579425362555762655150042062586380892842202898789022058741121786229161565364669698115669197768435716282216052652297187544716962107381796814287820284977782439923783093467632"
            ],
            [
              "age",
              "51462970069055647402369158205194604671702599898505730960751864779951787428331129742756166922760066253015153824921820932137055938112277860398208011704689323338536754071702809516226016424727515178514836160722230292504655786898566436913483077267094619430280886184295772646038595260275478978449006641135451296301343990787364979547473983956856516494359755988205126582308331909307876802005812608259279359522252756118252962504803179156951692022156494515835846503627122058605311828030215294188840986253666513079822108875441956158147138050612103486858389466207169264249505542882635195022147509458212886962338094953652942235332889001353162418615258704179642268063916879455642461209230785277716713361019"
            ],
            [
              "master_secret",
              "84217083233442101215808448360312804297419576696517668526716154800964931889823166799300276473752307743886965252182189309909604147527121358569713979180651797409147470224661841274425125430827904365766731515865099569183085735014226158753749039529625802387006868581911623796467147065705468726107840519051859902573282202738795659939388033080393746722942924473386922077424375496596596802000430274905219154711676012315511694424347888844193452138200850932720478247966446109728670624946449434765116450285584142751622207222640209887440397837870398413881739560365930643802817685816330177837735734636072470275771513832323263434427712957602483746833562807565438362192120097859182316296111215518044261710110"
            ]
          ]
        },
        "nonce": "784708612038083523810847"
      }
    }
  ]
}
```
## Save the credential
Agent2 must save the credential in its wallet. Use POST /credential_exchange/{id}/store, with the credential exchange id as the id. The response should look like the following. The state is now 'stored'.
```
{
  "credential_definition_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:21:default",
  "initiator": "external",
  "created_at": "2019-08-08 16:51:26.932512Z",
  "connection_id": "c4513b1f-0f6a-41d4-9695-8e035ac42c85",
  "raw_credential": {
    "schema_id": "UDyb3ptnV9wwi95no6MHvU:2:person schema:0.0.1",
    "cred_def_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:21:default",
    "rev_reg_id": null,
    "values": {
      "age": {
        "raw": "24",
        "encoded": "24"
      },
      "name": {
        "raw": "Alice Smith",
        "encoded": "62816810226936654797779705000772968058283780124309077049681734835796332704413"
      }
    },
    "signature": {
      "p_credential": {
        "m_2": "70227615207778282915390946358221310153086046867331598224929692702647508060776",
        "a": "85679013927393718435818365905726118518072784893531950304675239400484443346251462829835443730576077280360323233581642454369962852405161378825909562503194221144535837155100955120870530508571763146064925030930357211149486147371417232918573663441697431272650998916197100854600866071448514530613141871894540384817619557658632118124412119680459413413032710841800657492673839490166508370496681104588607887255275477121031826606296672200903277879574988253503897163537650384342758852401431469857010341772046790345514492388776276930286899622951002589168303478328021215931159389235460488546911325978836139635521266849166625316940",
        "e": "259344723055062059907025491480697571938277889515152306249728583105665800713306759149981690559193987143012367913206299323899696942213235956742929824000627020999348110416456088236253",
        "v": "7048848370171115788807749901277626009121387798757000296306566303055563129212226366347607035656521929083199549078888344352882310788255998278117529536211133711356935031658935728738638246358371080798951004953829111265651134602884461064011305358148618712404204213109483942229520116718795836964413414276944729592870810218485995706945883396320933131976698405561309366762344717729015524253205734673340189119612416250482617478936943936705736093756866853465016634579907563541108136606449766854540879198206350708935130306277591896950547779121450556504906848111959768940140803407737953881938539754360823538890037851681351526701822142787141733519436496987244771472904516322003529662098954666635967238319260308738406208202145861454507626740356698591958393654582850401260060857437212286180432417901147550812889962012912840345230979338"
      },
      "r_credential": null
    },
    "signature_correctness_proof": {
      "se": "12408944345424568758592716385474863353671516966328870945972264492354811075760295460974172030020226136840042714479272662878313289019068215152645988895535502886882125739255535609849034013770637017083921011530845253758644876185656333557111011685166369834737991721080164532967180022087363629624814298002574977277516106855657483074776858441982148718123769141248118081254500869903417681550017744056604025712612473210967370308073899823053988205317567318349858942629528066687317007780416873780270225682600388402141684838786083791564225156471392923113459280727364695470614247212989781040522729175760108451489596712886871920396",
      "c": "66393587881277659574021866596429793467828478454558582919616799530716105267953"
    },
    "rev_reg": null,
    "witness": null
  },
  "updated_at": "2019-08-08 16:58:38.265409Z",
  "schema_id": "UDyb3ptnV9wwi95no6MHvU:2:person schema:0.0.1",
  "credential_request_metadata": {
    "master_secret_blinding_data": {
      "v_prime": "3787991098844397155250682447618993239096606270747594813407647894642985403704533844206971043441133340617678515373290274239173953161806309661300899576768208614580299825197350978787058592904236774241401327406663855792696653860007018960178564177833306308080838797534027090714628074675440708251994864954082722979910019874198883759052045117441183943486024299004281367407434562551388635790663530148103704825845385754517812678228530979148108148222895527320364417285614366409548186640307305971758464547944653789272311652738025540014138638791322118017878451506322271713261968822498632217449490915639695320646592758844266082086423910543706509553680740",
      "vr_prime": null
    },
    "nonce": "310616660542479610758957",
    "master_secret_name": "w_aca2_cli"
  },
  "credential": {
    "referent": "00493d10-0e6b-4266-b8d5-a42b54dfdf0e",
    "attrs": {
      "name": "Alice Smith",
      "age": "24"
    },
    "schema_id": "UDyb3ptnV9wwi95no6MHvU:2:person schema:0.0.1",
    "cred_def_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:21:default",
    "rev_reg_id": null,
    "cred_rev_id": null
  },
  "auto_issue": false,
  "state": "stored",
  "credential_exchange_id": "fe6cd5a1-72bc-4599-8252-cf9249c66203",
  "thread_id": "bfdb30de-f9e8-4cb2-b162-94b1501732c8",
  "credential_request": {
    "prover_did": "MnCBzULyJr7NLEmbW9PnUE",
    "cred_def_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:21:default",
    "blinded_ms": {
      "u": "10791035157968612654968242884010484581056834698096893527963360594504071863041506402069922924734617425714758629999225817210500916488964258882875493500003408156927206331256179322850305263970113397881988663046847594708517936023092639830651120987713943985656238812466755477786183290103606150790346577312739301495498667217736514123361297733838464172024622447828664961711512387871292191401062617719073347024103705023858748526508126996028972802657285810660506760046771386968240019669125388735432506917262684522495667050318914861654102517896923536724949188320360492056989061295678990829767352669925484238533012328816233942772",
      "ur": null,
      "hidden_attributes": [
        "master_secret"
      ],
      "committed_attributes": {}
    },
    "blinded_ms_correctness_proof": {
      "c": "17289881482489322214031352601497333769969070400487815479055133871484934824485",
      "v_dash_cap": "65493917155744122165239850151850147695311151304562722518745229159453598038250837074132542080880065559537789923570782817315636215551708014586868235015982659949238406973090255936726626908309195515580984091569018895719139827629077688903727367166925088100899857581845651387775941406640561878770024500938324418899601762787142756307573449798094727244821336832260375233167204346471079991788274049337015536378085197253987945646666247223081673976444081763080036456253723212310864899264814278643411983037974130691349630507517704806424733687994074120562383994663868556516763666586725955935168245638163028353416275850713375458900237095401305370092399297009245592751135568602579086970521573856524347723304388861903094111053632401",
      "m_caps": {
        "master_secret": "14871527047310746298500259197357266811938124825654883641154234420145825888669646257774440520508756424466614890915833756365598583740598021811206774786575471029366991449717846803307"
      },
      "r_caps": {}
    },
    "nonce": "310616660542479610758957"
  },
  "credential_offer": {
    "schema_id": "UDyb3ptnV9wwi95no6MHvU:2:person schema:0.0.1",
    "cred_def_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:21:default",
    "key_correctness_proof": {
      "c": "5633244417270010081345610806094166299939390978982933673588774313945343602132",
      "xz_cap": "16707885381309482944544874586146235979669547483845584032549519044853752063550700898900379553244760521623187063186472251984666858865432636269208349118145151404137776137670175367340399679772867027055646528433240850386517786884497938933339182965732716152759587404299198734805019272537016918391351894566128309090145539336112689553605264867485763602565630708772284958265164497285013317826416107586880443287477714727102128806170807958099123266363299806101307840500984097709415495233231124577970425416742314946536593274654677576261685216888059200637812757180891897360020044920391052614858769292218658775977512682071796963944268432752380151652955324135701582400576591039772868480162585336423937119849",
      "xr_cap": [
        [
          "name",
          "53299455418379044509619153273198729379505304496867260195060222634784002989346869246976915909820246105029981770854102416732654918031793879374046499656124872138285005606223328994750537446768077172668446865992412557088358951505919417828099204698833771464559738541211693257835432469484254641469911902583654062063197175694157870712190053028837141614565897392762433610322320954527771632528095732788300479826387221448666163324276092977290084592279493100359585285445451468304395118195128352730791353611981931766218329785138932579425362555762655150042062586380892842202898789022058741121786229161565364669698115669197768435716282216052652297187544716962107381796814287820284977782439923783093467632"
        ],
        [
          "age",
          "51462970069055647402369158205194604671702599898505730960751864779951787428331129742756166922760066253015153824921820932137055938112277860398208011704689323338536754071702809516226016424727515178514836160722230292504655786898566436913483077267094619430280886184295772646038595260275478978449006641135451296301343990787364979547473983956856516494359755988205126582308331909307876802005812608259279359522252756118252962504803179156951692022156494515835846503627122058605311828030215294188840986253666513079822108875441956158147138050612103486858389466207169264249505542882635195022147509458212886962338094953652942235332889001353162418615258704179642268063916879455642461209230785277716713361019"
        ],
        [
          "master_secret",
          "84217083233442101215808448360312804297419576696517668526716154800964931889823166799300276473752307743886965252182189309909604147527121358569713979180651797409147470224661841274425125430827904365766731515865099569183085735014226158753749039529625802387006868581911623796467147065705468726107840519051859902573282202738795659939388033080393746722942924473386922077424375496596596802000430274905219154711676012315511694424347888844193452138200850932720478247966446109728670624946449434765116450285584142751622207222640209887440397837870398413881739560365930643802817685816330177837735734636072470275771513832323263434427712957602483746833562807565438362192120097859182316296111215518044261710110"
        ]
      ]
    },
    "nonce": "784708612038083523810847"
  },
  "credential_id": "00493d10-0e6b-4266-b8d5-a42b54dfdf0e"
}
```

## Issue and receive a proof request
On Agent1, use POST /presentation_exchange/send_request to request a proof. Use the following model, and replace cred_def_id and connection_id with your values.
```
{
  "requested_predicates": [
    {
      "name": "age",
      "p_type": ">=",
      "restrictions": [
        {"cred_def_id" : "UDyb3ptnV9wwi95no6MHvU:3:CL:21:default"}
      ],
      "p_value":  18
    }
  ],
  "requested_attributes": [
    {
      "name": "name",
      "restrictions": [
        {"cred_def_id" : "UDyb3ptnV9wwi95no6MHvU:3:CL:21:default"}
      ]
    }
  ],
  "name": "Proof of Age",
  "version": "1.0",
  "connection_id": "fb377829-1b7a-4c83-85b6-8a3dbf6e2051"
}
```
The response will look like the following:
```
{
  "connection_id": "fb377829-1b7a-4c83-85b6-8a3dbf6e2051",
  "updated_at": "2019-08-08 17:09:05.830181Z",
  "state": "request_sent",
  "presentation_request": {
    "name": "Proof of Age",
    "version": "1.0",
    "nonce": "111301346160293691683693576433563183068",
    "requested_attributes": {
      "35845eaa-2f2b-4369-a34a-5e4afd296dc5": {
        "name": "name",
        "restrictions": [
          {
            "cred_def_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:21:default"
          }
        ]
      }
    },
    "requested_predicates": {
      "85c96f5e-7f0b-4286-8ab1-1ca8931027fe": {
        "name": "age",
        "p_type": ">=",
        "restrictions": [
          {
            "cred_def_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:21:default"
          }
        ],
        "p_value": 18
      }
    }
  },
  "initiator": "self",
  "thread_id": "6cacefe5-f5bd-4dcf-aa01-97425425310c",
  "presentation_exchange_id": "ad4e80ec-e6bd-49cc-b6df-9d476fa76057",
  "created_at": "2019-08-08 17:09:05.830181Z"
}
```
Agent2 will automatically respond. To view the received proof, use on Agent1 GET /presentation_exchange/{id} using the presentation_exchange_id generated before. The response will look like the following:
```
{
  "connection_id": "fb377829-1b7a-4c83-85b6-8a3dbf6e2051",
  "presentation": {
    "proof": {
      "proofs": [
        {
          "primary_proof": {
            "eq_proof": {
              "revealed_attrs": {
                "name": "62816810226936654797779705000772968058283780124309077049681734835796332704413"
              },
              "a_prime": "29044364586137304849337360559057108242252088989671121451195421465705376211266121943809171417887277440837719859470641548848928883982741757504586035486760151214637244954572931206205383280825722133043129545378092824483223527458228108786866998749815749323046500707015589100614318328851758363932242566609824316397191370405851492472675609723928237507982260128122515656115718112108979517880571348763654438232616648108778061659515932958209345109637969554811956466893533387477856881981380235085509569970342533259342541394275423202214325904560906351974679064544382372525896360327543688167340112500908023405657390736840857733794",
              "e": "94224397255772556331809060473529831226314775449564920674147248771104640042782354956265372799049365269919943362696234307445416586398370296",
              "v": "1211331929341848614070987318164957195271160721103822320888182447039064512106069567806806650586445041231344189969527829492689159841644279961326414541914852861554924428048247352535282708814978252507526330613268564636812286748087168637965470582485915114792114516153268248117100502273544008178314871442725553979879106485680894176206406541649090173916040108687713287171111037386446501498869248791453985985449471283235932945651667478850259218305007276216861906961606440530870371861153063547333325243478100980627912080570209446449899205952328143153614720551448238313888147851339654649615571454158233735297561352306328172806954949283928130542722342768513788112516714578888151540404079105597467823207583160988221716777139963466048004096554418142957636451741497434350467756390474963604229958903165666015341562495243169388380286756910102506114342317313974473766171572109407556863397990784437216871513239882880685996069936722775363277",
              "m": {
                "age": "7897403415849420192180805844450330442928067106390821482554939183466654888113213632326763337243865291702713779497843323794705717823450095487401091349294863675101462100762535019871",
                "master_secret": "96401477897438878977236278944095917486716005735963756071828301511033232571738743052766983979786624405213521224892312177498007345518177762393430780323081957680198950446008363321"
              },
              "m2": "8293121577383083329787620423292247511382599718210068738414924044049261751688363492312392667681654607229088782890358310772398592778518920879102791393697989493361410406301311018847"
            },
            "ge_proofs": [
              {
                "u": {
                  "0": "377659007154055105793191614873767042718110411075768650374527722328419800220614313495903717684117091429501042593393658585198078992132651071612119081208666315129609630860941657533",
                  "1": "15102189208386250142335476405755339995402090060927889238125509102361267378165769660244284280703814899916242755803342724999702597398342341679373651353709414633107589240996416857088",
                  "2": "16030379206420358843044189790869223701488123064306262175104749276942626886624900746328058640459331059344432800417503114918455617522462591083201158117862731643554949260546036536820",
                  "3": "16101956026036436147405423256187925676256039359738703241992816110567328957036815169914910161413843866593173779534491905808448785318832501620021455919413783127110096140019344067943"
                },
                "r": {
                  "0": "577935997294184453465162218332771704850287539003703609619325308700614660659816160999587084892203799953357792931460324801810248243439389535070204109367744763683542822362007841212401676927148045141197897733081116768733791045930314108433940146195214771739523412431091973767650093435098068742820504683379961755600267156851504747442900607621089017349452038736949629148478499171343267747934814012006344352310008560882906812759371275048339603162264416880641844400205346978391451071939709129871964494702823020961414057497106858361674038601858870617744921522891626636850890474076105666467060999101478314877490559780285546734828748974201749110085299408501595472952472492376467000507654304973179817826317237912469009473753485279",
                  "1": "667424618260062431172069638253737803643250360435623880515901802402415238325686366432050439809420284611946865522491127842954703736464158505280254451111124532061428891807606801898491371544818803532511175740215550529968292183506285120631980123589395519031983040840384999507344614706568252825918059305192805103830366712604949671246306548532827131314190362630032774109222052087440528930700176664470376562633755011423924873882231282955953298596921690239731976108739131740699962616878081796450694731504123248079877479025403416898414728520810591535005442783902471717750072667862759336941059311631343747794867963410792076119450678880176169032284916422085790832888654706303411484703867398766729233103908420871995194337810803447",
                  "2": "1527616296878982640069975423253824335571948684531702124335747533035581891293981589302730775866177574654391374770179566926622416459641181239652140358234293103002460321999895836301656189906193932602048595139544663519375519615033161050268868976445330925538657064898548029091598466799082889703967590338139142243454861567052119752665476971105526943976894085414904488057068697952313895776486362340545030367358074234530161730865548719782369226992506683649758972681106420830115409576046100579813733217981230024952518005981406412679227013687137844518875212779002360379355916340272557738094499318173935935260965316211844671070477051492864317023847077589085657720461558380490261305804833763783856360669840035612951496352337433390",
                  "3": "1206394914896862540113426895553911751529493925212186194069654088043190646377161427674613411147541607211264217496974085245217565966506381612253401312954311892244164340490391228596921067641488610966068350949938133482923616563880568297793664304334913373761058405144382945068850572615523619394987818503354130515819743454774552624544084035010174340718517606946728976198341272840044113804098806053308602125862081065155289918043245938145064571306566385569157314713278710826072840628376276434513984858908466711936512047832235251997479843842560544030989604249377478509792950919932193709209801122050388423652505274964016021531200492901055729089386786941303890890034554202030875908334903949563832943717609775283563574543369073380",
                  "DELTA": "1450886730172366795679141475117086400368457208527298355699218465785957632033296630902761573512121723699211941653272776770850924830309739229225154618237513659235494903517600774517086940965043502967732490737414749637471104637834917079853591543172723807524519073305509170573889452323864318413018469105202063659844874901889914300733622524600082123805373198808541107168094854060586456988882471113165094861019172519985252346112751825930344410637440480530682583228402393173735098551689600781833163811231759843423721533767040094639650477950528259594857385673251488436422768866437549342763100258381313845137487846197895429890309917704167664397209609447615723791745906848719924430903310226119551809485585121314244940823891026673"
                },
                "mj": "7897403415849420192180805844450330442928067106390821482554939183466654888113213632326763337243865291702713779497843323794705717823450095487401091349294863675101462100762535019871",
                "alpha": "30079254557479471198173045180763134573070261345784703062831531155749058686633414792658175918285203413648797431190588671247518798881349825116098661532324446509835597568469935129277326653603529630768669249993471206112431012667859545631337374433705517295851677891469598241390350824305859078131677033904404365348296227314473612570900321635698627785296445789018981463305347655067310537304109377268558414054747832099804365150913076823949722478013273756990848867299554487811446978916960500611353023902636831998827476896519583836627946800421108853059149935900066309902098471449484897758720169524685746869230232972482651843499811969678666338685810442260648538820428385305366832842598418284510660649235945272204067360884094396030579166764962170476539589234524430315847528395940425329004954247858707426446758678645052035568761066984770248154718573153",
                "t": {
                  "0": "24305608152263005383435404540148563122554847112246620951980664975423686806820579356725450399249292499239248044607065702239764995894693965648823004519769930169786851503987133077686324457458661902989458530855576604039720814205966465459141834560638912894825216674423476333816411262015225791812492276580993181083163328828402028935506636335185142070273406755314074593416526319494775679689451167784899687309750640830902863392214322884813192579403283141869792861256009862160550738750025617162000591455866313995804961495416790460694865891712187496213042621263011776785741358411556099473730027040292388783453694644828961293388",
                  "1": "64587712559660866108928523428028508800982628306974060405951133340064576519645569338027678851091360460609621115541527766258201856747416278202769349897109174894447525415653561338811990868027453274628750886517179869459403495443176801470799183505221201100702158508225137621863853681340421006471948911120353598192321080660617192456924230923898091247254252067917636278306504900702038601033160345490536752092901841677794380379000347692955143876672439984577018749523694899208215741145202048887018352624073274042155047276093924282974151049873322706580005580915417488138202679113899168415359471638796463510663459202313400574321",
                  "2": "466525908116207698266897825443421409803932456262871516895523156279068626646039706005774688795621359294419749145450103779981656332310415801241513691416511313291908386407121030291900195743487357675778740688343894449545077660157533540318204350071896883212293850270775762591320674342181767776517376320873401901454611036569129241200664944037857391405012359694846243483675102420067748495568334208933335642342758410076586294772525522447886535151026440630117308216008272308674487318145620417625047514317848583805583580399294882775723773478648961743425193063768209630384917835973133564905526760574315643979504692361931350908",
                  "3": "73639355118286582576749185245560178661919464778710806504138713038665169493052710888287175047737810224714084869074767686874179676336089060082546319965564403535757825615596100057653183491271335936917853727731558751982581601028742536066899383664357610524635888334682575349326958491665068706554663003151888052365061978271205356373599824220858292923262323786326732284309598548846702468979818931215494262860062165019806317726762363293270537090820555000250389675571630274977205748218655102536846875732963471954877091896228861056549006205653211272561585440797442255616889937890818274666799963643300135305709950401644774472613",
                  "DELTA": "17467511704752459858939061217456590221614069422470087501409440878166154976198444221202379067029555901029594455108925825998940745066722307424176046036561293885076414976600608225882479971083164086307163389735991306844158927057154451132138754687141761009384725652379147285005479564134138152141214127721282301862024707708022735601347898452662955757548916317486499909562768402129465971639920505651590910171680312278920730832427262496706547225954066774333386205342926524091867791643174639284596818397372443988755136928023970913444412788161060097771202883927396120951610903603263099587479090383610589524519263921205402616140"
                },
                "predicate": {
                  "attr_name": "age",
                  "p_type": "GE",
                  "value": 18
                }
              }
            ]
          },
          "non_revoc_proof": null
        }
      ],
      "aggregated_proof": {
        "c_hash": "71879259135773616223263644488462503278210100016220566194897097398588485460215",
        "c_list": [
          [
            230,
            19,
           ...
            65,
            76
          ]
        ]
      }
    },
    "requested_proof": {
      "revealed_attrs": {
        "35845eaa-2f2b-4369-a34a-5e4afd296dc5": {
          "sub_proof_index": 0,
          "raw": "Alice Smith",
          "encoded": "62816810226936654797779705000772968058283780124309077049681734835796332704413"
        }
      },
      "self_attested_attrs": {},
      "unrevealed_attrs": {},
      "predicates": {
        "85c96f5e-7f0b-4286-8ab1-1ca8931027fe": {
          "sub_proof_index": 0
        }
      }
    },
    "identifiers": [
      {
        "schema_id": "UDyb3ptnV9wwi95no6MHvU:2:person schema:0.0.1",
        "cred_def_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:21:default",
        "rev_reg_id": null,
        "timestamp": null
      }
    ]
  },
  "updated_at": "2019-08-08 17:09:07.619683Z",
  "state": "verified",
  "presentation_request": {
    "name": "Proof of Age",
    "version": "1.0",
    "nonce": "111301346160293691683693576433563183068",
    "requested_attributes": {
      "35845eaa-2f2b-4369-a34a-5e4afd296dc5": {
        "name": "name",
        "restrictions": [
          {
            "cred_def_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:21:default"
          }
        ]
      }
    },
    "requested_predicates": {
      "85c96f5e-7f0b-4286-8ab1-1ca8931027fe": {
        "name": "age",
        "p_type": ">=",
        "restrictions": [
          {
            "cred_def_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:21:default"
          }
        ],
        "p_value": 18
      }
    }
  },
  "initiator": "self",
  "thread_id": "6cacefe5-f5bd-4dcf-aa01-97425425310c",
  "presentation_exchange_id": "ad4e80ec-e6bd-49cc-b6df-9d476fa76057",
  "verified": "true",
  "created_at": "2019-08-08 17:09:05.830181Z"
}
```
# Full connection protocol
Connecting 2 agents without ```--auto-accept-invites --auto-accept-requests```.\
The step 'Connecting the two agents' from above remains the same. After performing this step, the connection invitation is stored by Agent2.
## Accepting the invitation
On Agent2, use the POST /connections/{id}/accept-invitation endpoint, using the id of the stored connection invitation.\
The state of the connection will become 'request'.
```
{
  "state": "request",
  "routing_state": "none",
  "my_did": "VwCnhNdp92b94r5gtyi7nS",
  "their_label": "aca1",
  "initiator": "external",
  "connection_id": "387d8294-78fb-4622-a90d-8173190c9f9e",
  "updated_at": "2019-08-10 17:51:40.670745Z",
  "invitation_key": "ESRUvpwsxnoN3BQH76f9h7ghL8cjXMcpB7nkwGB3CbxW",
  "accept": "manual",
  "request_id": "8d12fb22-db27-4950-aeaa-f828062039ee",
  "created_at": "2019-08-10 15:19:18.031911Z"
}
```
## Accepting the request
On Agent1, the request must be accepted using POST /connections/{id}/accept-request. The response will look like the following:
```
{
  "accept": "manual",
  "my_did": "2jmGdUYkedrvru6qWo42Zh",
  "their_did": "VwCnhNdp92b94r5gtyi7nS",
  "their_label": "aca2",
  "updated_at": "2019-08-10 17:57:55.104705Z",
  "state": "response",
  "created_at": "2019-08-10 15:18:24.778365Z",
  "invitation_key": "ESRUvpwsxnoN3BQH76f9h7ghL8cjXMcpB7nkwGB3CbxW",
  "initiator": "self",
  "routing_state": "none",
  "connection_id": "be3700a7-0313-4995-9c46-72a4608b5c49"
}
```
## Checking the state of the connection
Now the connection should be active. We check the status on both agents using GET /connections/{id}.\
On Agent1:
```
{
  "accept": "manual",
  "my_did": "2jmGdUYkedrvru6qWo42Zh",
  "their_did": "VwCnhNdp92b94r5gtyi7nS",
  "their_label": "aca2",
  "updated_at": "2019-08-10 17:57:55.667862Z",
  "state": "active",
  "created_at": "2019-08-10 15:18:24.778365Z",
  "invitation_key": "ESRUvpwsxnoN3BQH76f9h7ghL8cjXMcpB7nkwGB3CbxW",
  "initiator": "self",
  "routing_state": "none",
  "connection_id": "be3700a7-0313-4995-9c46-72a4608b5c49"
}
```
On Agent2:
```
{
  "state": "active",
  "routing_state": "none",
  "my_did": "VwCnhNdp92b94r5gtyi7nS",
  "their_label": "aca1",
  "initiator": "external",
  "connection_id": "387d8294-78fb-4622-a90d-8173190c9f9e",
  "updated_at": "2019-08-10 17:57:55.833026Z",
  "invitation_key": "ESRUvpwsxnoN3BQH76f9h7ghL8cjXMcpB7nkwGB3CbxW",
  "accept": "manual",
  "request_id": "8d12fb22-db27-4950-aeaa-f828062039ee",
  "their_did": "2jmGdUYkedrvru6qWo42Zh",
  "created_at": "2019-08-10 15:19:18.031911Z"
}
```
Note: The connection ID is local for each agent.\
The connection's state is now ```active``` on both agents.

# Full credential issue 
## 1. Agents started without '--auto-respond-credential-offer'
The first step remains the same as above. The page's agent uses POST /credential_exchange/send to send a credential exchange request and automate the process. The difference is that after this request is issued, the state of the credential_exchange will be offer-received instead of credential-received.

## Request the credential
After the state is offer-received, the user's agent has to request the credential. It will use POST /credential_exchange/{id}/send-request using the credential_exchange_id generated before. The response will look like this:
```
{
  "credential_request_metadata": {
    "master_secret_blinding_data": {
      "v_prime": "7350243590850818638789250779149843374473430898747522116341673153232641043666425266621027543100719766513832584719252335523050135594480360522662550734997579877556588116261688210982216791859939032802970483973874564010272660821854975385038110885086969982662707930150086722093405952796520469275772056399406277100192604197250583330786125184287415425172303435130350552001444959430301951579979361252105559827902154817603192515428137626349754467397129746265469607682905003394595331488357432736106679249750270443046646044120701389559794009511202076533619357742636064883324109002657157630050201845546969240611283392177121157452408183491493583595412545",
      "vr_prime": null
    },
    "nonce": "270749264711818752646003",
    "master_secret_name": "w_aca2_cli"
  },
  "credential_exchange_id": "ff774471-a9d9-4f05-af6d-214d81e3d285",
  "created_at": "2019-08-13 00:33:01.495119Z",
  "updated_at": "2019-08-13 00:43:36.633287Z",
  "schema_id": "UDyb3ptnV9wwi95no6MHvU:2:person schema:0.0.1",
  "auto_issue": false,
  "thread_id": "c83df91a-9ef2-48ff-a299-b5806c575340",
  "credential_offer": {
    "schema_id": "UDyb3ptnV9wwi95no6MHvU:2:person schema:0.0.1",
    "cred_def_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:13:default",
    "key_correctness_proof": {
      "c": "57055773512262084550915697118509204339410373652613774598952902597365961814638",
      "xz_cap": "1310869610603045013522098618307219077717035227965969142614615887970131371626949138438354195772283760386528282599478238667194800825450147547334867344941405497955006373935368569965854660159884615536382848994957687245749685625655624839156684988470245439495765844378732878341834542523680377996203730856980400847304892605468858287371111834150458851169227782130672575289539947967204903342344667370476651712956497492457245426060514364394469371381465635424394480437560427520535034064031326237464799249460698586583068457821227961791711697013271254574916800732065053336332325167192859635437629598553941633439634215550105580727708406859632049996468930593333631785046833128198265739603407028773440540004333",
      "xr_cap": [
        [
          "name",
          "1121900286917599369957251796161864258977699369822888762552429119303331230143990280247253294375857045848930353065396646853383397752681424411246948940410327084350258539314283053930317776260494979965481128821422521901227405855737069802469681572913716213289219044053072084452907740516359427150111745949521450959101359298364321407625311848874077322031946933063606636665622426664608576409108031987379858291926997222181177809030098481057286113179600478230135231123313192207138841818682629072486598062115174685277237496475579228271192615935399565533026078036305015678758421309476133748178164871723639887026409349196673713594715730937878631590228511102040340431633730569218574646918996904508564593987299"
        ],
        [
          "master_secret",
          "650388623463903841444237150522937176560298865304514014579898215006240425395640523628687077283339619314981378405158700446825136057070773211787647986807432336016481759644906739175982020868541937000562456186876636631235146954860085169374470839308987414528790253891739349878614860549122187952116616036559622326369924606402752932433939197153646148819784717243271828490408407431992615687585343758939427457863974791874663315203037490850581556973885601873725520438064823952092857654567470072712529321834483741087992629385950065312487650818206759419732193977478907183933734929575665357727979881823614231868824306975983483624711438726466164411730086111155185118631450750900973140487918964584980938862261"
        ],
        [
          "age",
          "803031533879232428951870626675001721346644656740774393674440497551355903296654542215020528032354697241186342162713390133391966014102188788017119776367155798812407755160082078328032741646137856069623419353037346969961074107896239449132602153007115094385668061207559647695458077701660455141002566641609834555903483777165050767876983320869640464288130100654837992948210779262698942369169409604835756918949396377106497923773802677690877033164403468880892893716990829671520705692064214434642565162280882048417979655480790045847718657866718499731841755299575521837530053560759069547716778547953470160110612066641740064586043246292815095542014151707826524863589185642319720723073251799201938149684539"
        ]
      ]
    },
    "nonce": "965621698567102855901904"
  },
  "connection_id": "564266b1-dac1-4db1-9afd-9d79519324b7",
  "credential_definition_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:13:default",
  "credential_request": {
    "prover_did": "CnbGQSAtcDcEAHG4xMA5zE",
    "cred_def_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:13:default",
    "blinded_ms": {
      "u": "23416567216409297038868709944655594632281136341884218354097420806765447286448813631500163891672313540430557716097243204425600345693687595009154433158413267293519366436320917089476904151956797718842292925404088122491449853432489205687256576772494912505496031575681113535460994648023893791285744868347486698285964161590803681980367605941795509331610186292203152747730148850242837403243814174805441629820398666708747129583705404572781821720612634857908385066211103155259870095690146174266523924857662039537168501607185321895055993414772851595838849201845409162091183399083258308018830637766489404610585435920548548686696",
      "ur": null,
      "hidden_attributes": [
        "master_secret"
      ],
      "committed_attributes": {}
    },
    "blinded_ms_correctness_proof": {
      "c": "105764160462071391307523498267515757672059410427058200308726588223213923719610",
      "v_dash_cap": "777392342578057801117533789777034889247074067590414495101460276743468097564142847193440148091912080142489700082909995306531608512307046813090093023806542556239019516538084251494238190227950903894269755838667439779309397565528579469063361358105866686607939978608748049630938533390059402073070882594626708883554455448479900565858022910547401351519744999310324462668578457249779329959520277502840343238272871696443334098890823460402067526206727481833471653440424003842327192688419648684378126491607846658652945709652043791856644093214506154917320868338159967388141068803686781464769601555225172758489444271245981211187653831279729267292268748441348909786106251894994333091411477665805996016703360178170990662235424773843",
      "m_caps": {
        "master_secret": "16585923198796135481023811039928594803674217988686031281075376034059132400546455003026128213793141648436497576100707431953875535328055728551988424988626331716494304805720802470918"
      },
      "r_caps": {}
    },
    "nonce": "270749264711818752646003"
  },
  "state": "request_sent",
  "initiator": "external"
}
```
Because most of the communication is automated, the page's agent will respond with the credential and the state will change to '''credential-received'''. The user's agent can now store the credential in his wallet.

# Full presentation exchange (credential presentation)
## 1. Agent2 started without '--auto-respond-presentation-request'
The first step remains the same, on Agent1, use POST /presentation_exchange/send_request to request a proof.\
We request the following proof:
```
{
  "requested_predicates": [
    {
      "name": "age",
      "p_type": ">=",
      "restrictions": [
        {"cred_def_id" : "UDyb3ptnV9wwi95no6MHvU:3:CL:13:default"}
      ],
      "p_value":  18
    }
  ],
  "requested_attributes": [
    {
      "name": "name",
      "restrictions": [
        {"cred_def_id" : "UDyb3ptnV9wwi95no6MHvU:3:CL:13:default"}
      ]
    }
  ],
  "name": "Proof of Age",
  "version": "1.0",
  "connection_id": "8af9397f-2e95-4ba1-a905-0f045e09823f"
}
```
The response will look like the following:
```
{
  "initiator": "self",
  "presentation_request": {
    "name": "Proof of Age",
    "version": "1.0",
    "nonce": "40742161369730854361644925729740930940",
    "requested_attributes": {
      "24c0839e-ea4f-4399-b76e-b1aca178d3ac": {
        "name": "name",
        "restrictions": [
          {
            "cred_def_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:13:default"
          }
        ]
      }
    },
    "requested_predicates": {
      "1c5d0a4a-f614-4eb3-87d2-3cf2de58e640": {
        "name": "age",
        "p_type": ">=",
        "restrictions": [
          {
            "cred_def_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:13:default"
          }
        ],
        "p_value": 18
      }
    }
  },
  "presentation_exchange_id": "0e01bcff-b2d4-4f17-b7bc-737796b20d48",
  "updated_at": "2019-08-14 17:13:48.082038Z",
  "thread_id": "1dbea3b0-23b1-4e98-a707-5e00481aa778",
  "connection_id": "8af9397f-2e95-4ba1-a905-0f045e09823f",
  "created_at": "2019-08-14 17:13:48.082038Z",
  "state": "request_sent"
}
```
Agent2 will not automatically respond to the request because we don't use '''--auto-respond-presentation-request''' anymore.\
On Agent2, the received presentation-exchange will look like the following, with the state ```request-received```.
```
{
      "thread_id": "cda24a9c-0030-4d3c-94d7-537e08c70b67",
      "state": "request_received",
      "initiator": "external",
      "connection_id": "6d8340d9-1e61-4637-8572-13f6adfc2a59",
      "presentation_request": {
        "name": "Proof of Age",
        "version": "1.0",
        "nonce": "56513848552692593312780860304148406011",
        "requested_attributes": {
          "97fbb1bc-f2e8-4835-808d-d4cd1c627f11": {
            "name": "name",
            "restrictions": [
              {
                "cred_def_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:13:default"
              }
            ]
          }
        },
        "requested_predicates": {
          "06e23f5f-79c2-4392-b757-ab7f4e9b8b0a": {
            "name": "age",
            "p_type": ">=",
            "restrictions": [
              {
                "cred_def_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:13:default"
              }
            ],
            "p_value": 18
          }
        }
      },
      "updated_at": "2019-08-14 16:38:39.370961Z",
      "presentation_exchange_id": "fbf2c145-227b-4c76-8bef-e3dbfa175abe",
      "created_at": "2019-08-14 16:38:39.370961Z"
    }
```
Agent2 now has to build a proof.\
To find credentials to fill the request, use GET /presentation_exchange/{id}/credentials. The response will look like the following:
```
[
  {
    "cred_info": {
      "referent": "c0d97166-b9a7-4f87-8bcb-689cf862ebfa",
      "attrs": {
        "name": "Alice Smith",
        "age": "24"
      },
      "schema_id": "UDyb3ptnV9wwi95no6MHvU:2:person schema:0.0.1",
      "cred_def_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:13:default",
      "rev_reg_id": null,
      "cred_rev_id": null
    },
    "interval": null,
    "presentation_referents": [
      "97fbb1bc-f2e8-4835-808d-d4cd1c627f11",
      "06e23f5f-79c2-4392-b757-ab7f4e9b8b0a"
    ]
  }
]
```
Now Agent2 has to send the presentation. This is done using POST /presentation_exchange/{id}/send_presentation. However the presentation has to be created first. Using data from previous requests, we build the following presentation and use it as request data.
```
{
    "self_attested_attributes": {},
    "requested_attributes": {
        "97fbb1bc-f2e8-4835-808d-d4cd1c627f11": {
            "cred_id": "c0d97166-b9a7-4f87-8bcb-689cf862ebfa",
            "revealed": true
        }
    },
    "requested_predicates": {
        "06e23f5f-79c2-4392-b757-ab7f4e9b8b0a": {
            "cred_id": "c0d97166-b9a7-4f87-8bcb-689cf862ebfa"
        }
    }
}
```
The response will look like the following:
```
{
  "thread_id": "cda24a9c-0030-4d3c-94d7-537e08c70b67",
  "state": "presentation_sent",
  "presentation": {
    "proof": {
      "proofs": [
        {
          "primary_proof": {
            "eq_proof": {
              "revealed_attrs": {
                "name": "62816810226936654797779705000772968058283780124309077049681734835796332704413"
              },
              "a_prime": "52717756833114273052863371576281796550616637906336503390238108788683998049545848066550251716729190632957198793774997743359052531365022951794842796275647415587365849531117864662322724769220604674657538539193753255222330358385927113625857442178163215285021566891690451777622254460531069444984635790225717984774796423952135633685267892044973924095055685124541665653425852740584363466339974782590551910907017162608503228970269009389676119801890944895673903903394791794509890573814541514043498603591326974665606529865871784550960559028398317429012950107538459115994637718866773477624036022363607525550654709432362419264778",
              "e": "165183201951588712204083394017679949736733696107872173843981669449712932960457860817728384709703637126885127564547647414769439854580550429",
              "v": "329890923903331220345810746906407237866986131967537226132454690995636688741551060375713234008778016737237133652152715219087490064917677350699674960219046138337030292481207834370507993533938337505489733610167676957194733738360502451646611474508813742488433916838973495420311749900782061464600887789222684296009225546190836970362055245647612190015117545958962827734053544137706835997531656820867253623196193797518899330000535958330115064875376459885282637574485392736689681852082935725687610108860452968378256291907637520016028866318729262893134231662504815884329877557132623362644034888149438248868999549642337873648631383647132233103550164432727041275063767334078701294628529244726766894843490502889874762523256640147534599261373258787532961595199161561617274586949189608372833331620315754116382012894163377454499681424218684661163669718093622164722754754091946929337352558930186620844976734005819088248436918883214008752",
              "m": {
                "age": "4827520430703550580484244236989429665861020103844359097098367037574470557850490455820025442339585359649692793106643871397191967271906378726510753646679891722329412055729264109304",
                "master_secret": "11122206620962211675494387000119484060111239726853406703353505641987518410965680062859218780142071842466764558405411705313261261400902053282756697318106553424039162992790381031741"
              },
              "m2": "10769427909748374746050605212607126711402470704854261854708493490932629100702401094584371067333718271920545909444404083796325550878951194436244290330420034078578747666022608752732"
            },
            "ge_proofs": [
              {
                "u": {
                  "0": "3345768216128937596521633701450917891167524242547137802871080116907233768133913858760459422204677411184491036262950652629496289745036068225078351028846876646160060874107619342697",
                  "1": "947812074882719260692245983576907320531835507816460339891149389505916017493685521505747562640354559699302799011682431863778747862525050034258198389243922871507174100606150985707",
                  "2": "5203430459909797461152519435710872696633845457967296001598560873308680902255109250880316718411081648173867744654364357187911625797450845444319738695092239970995315193958512880805",
                  "3": "12111650650784343257799553690008209072290789677502080967622166086695998217041935568304811857499139229975827447111508446499579649393336877255502875209842309540662339209585107546867"
                },
                "r": {
                  "0": "3160051464247483311253011482932636468738138507169890453597590945137691661361217653561311354259389173918250787900006547742399615400358210500146261312706985650359446509873469741407863206267678177436543601960365647284072266799800977573552024900174916840371732761262965468169477997035007277434806003864333469049056147035640982925087694954209408692126599008500979688377754602190897976644182165268720020288758842020361276030641410797481648516983104735434121443710758155596921463143605360183236655453416518179959388327724468127149166201894311029905287247853423442307670528716263236807022501871307664063121291761992299899678468710753911145470112538182321474974921781310556911438999881828100242825791510081508683315455250370556",
                  "1": "2750276369334998364105871436318595485831876055539023355831503061800620812274054082050512311862262008843763510567002696720618232534494399572662277302598187891694456705819906514953206599928372450191670245673720908650548166382106994098386097582158612061601131666088729389166801299813901411778393280235879791430178593107830694707718073892103328541676452011065717371182856733374864329493836455814341426655707426934371127798420494997291722320692030032714938973971479369394311414578616071198045350974193657679271104656764803190768250479909101363809205572416971040759004211697553382813478694701988655155426873158853496422105757054366458889571124350851091546498113818170795361376021487252089111178781241002632587764047270685443",
                  "2": "32321967785489568007510784554447403453134998642989399107335262701773477928723550787856448357318870805001009032079903916013368550306273518976309900760955388326777618464326863121151030868745646178041049946284603202183792927345289585546887895778780021204222844183272162580613485988054756860904984659271715680128165248666592692076237189553566114879054636537058553951503094616844813075546017205559817328306391278004866404367096832545348624882729012578181713885512036860943469570248911506966858081367127724751259124333677021280317800249830125576290510672223678033536769616711469237143307157648804304942696602942456709688145962527241789610946008652175710696530688551490176389651445850381667309450660486056957739339945195171",
                  "3": "2532514567394110134463539681691917716197893088969349429715623724816363052480234423008525757815961091042314995088651707919420980822471831602453362567939520258379868133018285155529348527877523907898943001565572391720798751289652582486406373967316179980360231984848005679073238826721275540718495021571614030561266882377027141614153122587012905686067152210894670247050816465855174179446310251279498654219551249671845401906092824226568162366969629940825787469528485672787237815502934790971856408540562274289629696095628572111878861110573040855727914857932275510253686773414416058146117378963052431627824317212840447386109672184526701045745712133068919696146282268063129873091087767513909616803102413258599603757516573390707",
                  "DELTA": "306180274954412167137734664798664603936507766379783508020310022397704484264184532428187076249695220074017199286476363625303652245232953272692730785816552764732551606361681178660708841649059487477025609700722131045690136030532333537169391970663985274813687616817680321832706434482394527998670320355844079238142245647773187553614315646099191372540697658623616941788214379911970898392248486503743568669861807647627548552735312141539028580354855875913047827311860006323168562383042659018440883991088553297491237473680065833128289224588982261056653358269021059749073857218139553868020560327831665577321502155724884951386006348478299889331504152038210831510955959565725284743771971113858047985545810312797397852042753170998"
                },
                "mj": "4827520430703550580484244236989429665861020103844359097098367037574470557850490455820025442339585359649692793106643871397191967271906378726510753646679891722329412055729264109304",
                "alpha": "41639311413008899394419083123292692139402503029925159838747659726743158032186747706559103007205470483300814956039646413815905074984087787012074680441108108644416783699890255318876522861306758471586235475293125093149663419046561723038292011764576172203967780153767256504344842568955180171942111093200803337940337308203861260736088922871444372730730219994027472993780700637662829727747817708256977806045031186254910435095908934560430604600155708818088616896870825410437967915233154574905307086669002278639056657875288890178165744566770786411552915088661383115078390132403452647488978879835944133060527552701525559151974935225570176592721223999695148299151841065364167076532239028371784791265315182694441518872343409386454335409673381066175379033504885602755253563444792492235135953943325943627957416938790807540215868500719344017162107165351",
                "t": {
                  "0": "58364086848961968091787848561663255810086486231947437786631920737727015936275934669759547353398345976859600158580620851828254493736577182331495221325757128788897836537038485329690159198773456152288650978745314968820034882377279361200708805152878610501871741860327238045428664384937119940647761872396982330647474723059079483224064447620145532626926986645631271100442274698957467827784542770882253604845585346123289456011404143211822073017207945407730810513474756025602102606509921469183990891328665032563858010875596838590502007825396899821521408498010085605727930636872115669062824979941870412904744871995896826665566",
                  "1": "27796795172221473194295796471567391648218058395437494469709331408339144469741771451390984716792601570854682648381510937323414297132421223739323797976985448815688081588279274560739908461721171917791065112394302079515956468143973770743910206639896141448963141033675687690912611087073413739757903990505493406590602752194291286166017644251314845735266949480289801806340012164943309080869591425115995644174218383317700664291115697069878772045929817323806165112498570185994688948388522555964580486567844364227023506235247930362345399907861253460908601442277236596942713839917167321803537490263317686350018075752573183427204",
                  "2": "80744353148174528249595617457379252001263719555578774551664144466164015441099429974569881867119832551850896340001131683993085106305714632985654763979282758224418891034109315142371178143566282903414580804077533838220654402659611559848318090885356910985994090526538409610679478220005951061407159075173423877572688721991304033772433488196843017777841514312390755843999216749040586548953036349104867197733424939437934765763903802416280138015199176657365350062616963284042856940232748527887510397870000204771446085470799828686069920651128056639223214182562445166078138593819603912502310481498467542987836659854303838011833",
                  "3": "47167324956567433594416945417273386810567358015589316542649236129998997925078463545101388333540273509891092369432617358550182770761339136531989993533689986745068411228652779678544562526898078225327889344105131456753108694409113878628791007961805915864552365182680706821616418349354211230867310245722696308864636714614347006768116285416227964741861816726818730152031887612028774373934669252144283434278360554661148528851727159300357145045634517724988021927074226438687786294306354822416784648761250868888712789829675211962867155644462709368983734732341154824324948972023025417565858200374185706476417736355112554875247",
                  "DELTA": "51603982070588847524533697972460348035071843544335637452609118348789207378446799277072579823145016677807618249285819024028899664499209576134319959677210489591135017834530029403840073930239325172371271143623512481795338681608329311278556244694988987864549361725111594855945519829058571952679802173068525375012833568976007020769393687957865984920730801349698278235749068806355472946113434775292147761553276509822103730326217176534889583210410177187696439613999556191126798403877331238031909498999536661999073899629072832313702486511970346358526742042701641800255562938008595724163688634927039061848700811396260174630654"
                },
                "predicate": {
                  "attr_name": "age",
                  "p_type": "GE",
                  "value": 18
                }
              }
            ]
          },
          "non_revoc_proof": null
        }
      ],
      "aggregated_proof": {
        "c_hash": "81882116967740812868349776916317285645652427405425181690181353963980042976815",
        "c_list": [
          [
            1,
            ...
            254
          ]
        ]
      }
    },
    "requested_proof": {
      "revealed_attrs": {
        "97fbb1bc-f2e8-4835-808d-d4cd1c627f11": {
          "sub_proof_index": 0,
          "raw": "Alice Smith",
          "encoded": "62816810226936654797779705000772968058283780124309077049681734835796332704413"
        }
      },
      "self_attested_attrs": {},
      "unrevealed_attrs": {},
      "predicates": {
        "06e23f5f-79c2-4392-b757-ab7f4e9b8b0a": {
          "sub_proof_index": 0
        }
      }
    },
    "identifiers": [
      {
        "schema_id": "UDyb3ptnV9wwi95no6MHvU:2:person schema:0.0.1",
        "cred_def_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:13:default",
        "rev_reg_id": null,
        "timestamp": null
      }
    ]
  },
  "initiator": "external",
  "connection_id": "6d8340d9-1e61-4637-8572-13f6adfc2a59",
  "presentation_request": {
    "name": "Proof of Age",
    "version": "1.0",
    "nonce": "56513848552692593312780860304148406011",
    "requested_attributes": {
      "97fbb1bc-f2e8-4835-808d-d4cd1c627f11": {
        "name": "name",
        "restrictions": [
          {
            "cred_def_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:13:default"
          }
        ]
      }
    },
    "requested_predicates": {
      "06e23f5f-79c2-4392-b757-ab7f4e9b8b0a": {
        "name": "age",
        "p_type": ">=",
        "restrictions": [
          {
            "cred_def_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:13:default"
          }
        ],
        "p_value": 18
      }
    }
  },
  "updated_at": "2019-08-14 23:45:16.092306Z",
  "presentation_exchange_id": "fbf2c145-227b-4c76-8bef-e3dbfa175abe",
  "created_at": "2019-08-14 16:38:39.370961Z"
}
```
Since on Agent1 we still use ```--auto-verify-presentation``` the proof will be automatically verified. On Agent1 it will look like the following:
```
{
  "initiator": "self",
  "presentation_request": {
    "name": "Proof of Age",
    "version": "1.0",
    "nonce": "40742161369730854361644925729740930940",
    "requested_attributes": {
      "24c0839e-ea4f-4399-b76e-b1aca178d3ac": {
        "name": "name",
        "restrictions": [
          {
            "cred_def_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:13:default"
          }
        ]
      }
    },
    "requested_predicates": {
      "1c5d0a4a-f614-4eb3-87d2-3cf2de58e640": {
        "name": "age",
        "p_type": ">=",
        "restrictions": [
          {
            "cred_def_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:13:default"
          }
        ],
        "p_value": 18
      }
    }
  },
  "presentation_exchange_id": "0e01bcff-b2d4-4f17-b7bc-737796b20d48",
  "verified": "true",
  "updated_at": "2019-08-14 17:13:50.350349Z",
  "thread_id": "1dbea3b0-23b1-4e98-a707-5e00481aa778",
  "connection_id": "8af9397f-2e95-4ba1-a905-0f045e09823f",
  "created_at": "2019-08-14 17:13:48.082038Z",
  "state": "verified",
  "presentation": {
    "proof": {
      "proofs": [
        {
          "primary_proof": {
            "eq_proof": {
              "revealed_attrs": {
                "name": "62816810226936654797779705000772968058283780124309077049681734835796332704413"
              },
              "a_prime": "40511034671287625890823640516973688146835749596405581002711804180697284817925368551192065413661237650516957113712032914654385062345523355779462750381312487448677188552975555889370828338945052556297088151899731749828749210818749464996946991194440831346126485445711587568629132712101256651695329835788575610641689698414016150536434074675704324030758191708431971591234417173645495090815082574449565072387997378835340842900464916416194677687243748727735949838263542274944049961795659527880387208707075194566484874769992683758810792201243499111263257129908925146976862799235334813125717787939577930732491573511504959198405",
              "e": "2036447376126018073054970558878254826126997510325276736294155359074329486894369438261024308800171528486595921684359724949779188052980963",
              "v": "1155255605692947094678928449787756493974019058198739463930615417715262786099418678985922897020057272659024860800864985954691536203198047202029636175952539213747547470185913835038031598318830350333279135338381765947290397631183386599141677392622154377648857228051604503437327588531279407629048371907027580810960473035354741201839248895504627456734437403024161528817072744585857480843476293386490386591832689861015813135640741070011649480279396051373808433680733493598439299629650146690414875013612665128699589561922121569727384282033592855719120381838963888992306106276049855523713524005820381090063140322809799517152119215579712134506407288713374911564263347125137118178542653515690325023678729709564517148488245417179952576228540497532344784293689379366488604041196047876486099835795117553108527059604191620662108374096550034962777680426901785391325164795241758244420343534732512191206462422846510329432674654355411648182",
              "m": {
                "master_secret": "3162546030524560176093711598058341758989763270914842934621276470462940808245770922118272496490855677241661268837718464998338736378733408090388637566408647865964702067877731020742",
                "age": "14705448372062871734971552614745038967847344808170235461725871382217418242390997964269299717787050736287267851097771205886758426839534667506906261810560166406340439262326121115446"
              },
              "m2": "814312577771696686394453646626689585234786070696222928002174799224781074498282642210441800495965081619372107765116408480226592438398691379409911908676640508032311554488743808665"
            },
            "ge_proofs": [
              {
                "u": {
                  "0": "5972400227542097985976026410552584330644252836111567159325951612393843972450578824153544429988127210283381453477090000324081894602628789734997392472690226648023016800420294675919",
                  "1": "4909621443704986365209622086089658737806579633219383525930273015560028368491864144108993830729289730618056382321174963852890293371781342944148989608747934287429631351823491657991",
                  "2": "16072460428755200640269913913037380594073908763992633878293857556068761219895395217832815840923679270772359224258782399459035735396509462683220560734937787190398776180215899456755",
                  "3": "15454289252144237411477046768942299389340139175640030712971943499474475786416734652854519245055704858814112889745371542955487422174356820898375214481477991519333531739039753172120"
                },
                "r": {
                  "0": "16216168380475256420695452528877125174826416565070586481761158445349525866833129701492592501694219842664737288020718905598946405500446484967949855310768076669730741914066028539668566789451368345945656457363746474536435354920865490590951625323442401969052828301690576074720573675122602242111954328044206667349236694974123228337249475974492947951853610279045201332260903139333804138226790341647764875833968572561686526488741409517040094500927410604712436031291066627547558094186673211586501485162437521247000144639448853875562556357360833064767156392703700101675602933222095875744083929797727356346491335005557316140290691269360480333061746778582187052682042949325975448026330857990886773878665625682842779688944803353",
                  "1": "5343530513402179255377356326733242516684865044509376844267716570520362728836239148317339584795536385284734386397429332435648764195242351889615816081100347419997153090795021308181265395674828187072201585147741462227720867973250812778706692183710755297797841672461671807868484584500231355757304658022135909807959744539735292576644814163886409056003405469893839319866146102537883932006914253514306496189679246550799972580610722684983200042735965522153975296375350105721289311216047278576825727215869388207905901436229315590391468905139640691273824609843150602229906344985112739621887760829644918633358120334933606338745452582655194795512376805805381185678832064579161027099606720167401162004694098912128750648587392451",
                  "2": "15868570510255364755681338503166689090623120236891642286582642780524874444502460351007752078885206821727628540156935643691188970324723120901178145890715980323660184178559521078772073825008469765391986572656941277335517550741224957251197839005833098351893991584575541543776133541060281260614295222822743681213557073014859568305523441234513333828010240798089892003449441080041153765754904630568569917998281839869694076521571010257976687424555368722839927802371219057355825292986126592426586635325912046046446652866995007503101945751333597125402642355620865523375250827749395918810028590891132679089420362120185212457305092426443399106854922799471123074802623054246348516645939403310627680132099005121631511221594148255",
                  "3": "12851044806409573912665246455163794711542907024044885350682402366170281669197827862835543919298572455160176261786458916903827617762791726867364975827106814376603968189916385641795558015477880804478182333830096719188507175045242896705783769534494795473837483732001405099433357119763583983485577119246114652799383395109446313279708761510520650567566630194715770293168452569618481135029330653318196460737421868661380745326178999102931034597917176694910673240289370015676888890981255521237215627309017893722071787922011100714214378871698337134527816168285568347300275271306508977147492390617551217669173203463958330146033366034094201610619886475074212182475082774924703727855196521657442322777925221850301040066233286319",
                  "DELTA": "29280674428082639916786940203961082030624792699499369489081972219680373466269587347693715635521021095467081062109001094276288346193752771377620882447066673601140984042129597510550146083848856339177432006105170134636721848937514371301718422765718190285057756247703487154024739895277854901378754215789772775097952210379835302668476164890266925518498485340002719663674881174075572870891359853129706258571316029672585325917092131964156231754315467689683625597448404413474884242228235325775372827054061356465942646644141271275021538855651611604158377153185381959188205185241918756828729408986797866560636012951217150569070877184879101963615555701300076050677387192005609858342865500427425083381556731839794949317940038238"
                },
                "mj": "14705448372062871734971552614745038967847344808170235461725871382217418242390997964269299717787050736287267851097771205886758426839534667506906261810560166406340439262326121115446",
                "alpha": "92026947225106021316508816020221253499859512983728671045338932971855561550645313223311730584268353177053613178797327661870325088540471224507204967544458783183229548357540883513349597671109448070476386749768535720768560397240187912027283348451703161084950488701696097205774098898193849197979548313298250866516511457134285136188271908293113515383126255783461301114482443962839418256025052034835277879207310557676941139886458843636265473872784085288272139206616008239511061500769746525632465965540213639301135699956205502348827400979862874779775372060895352289716814227859462685678391569017004119996401970464060882820700856791597757361306566349571472758685612813023842169119952777286237545624923497065560638608929029612792221736291985100139561130334587598534146993377426156273836946223854281957946537013122413970530388583437297993252776430427",
                "t": {
                  "0": "29678049494514909463625939776271064801215639158138148386499953902685675380813265207398126246337174000951812622724137054966349886412990064572162664713220895079119900881283435810401352873873050725070662222412584617019920645407767735383825491528279121142935346622680171182037953435769604629830243254248732087092987839082038902681492667497024212339735205459895228589635097094948787893810326942461019751020699034666367477191890864947217785309294460161905485005121048550625042196100493103288760048237435607443803729625551446149165500968038671319060189223608766711115693550948941786178025367930620960658313004221278726808932",
                  "1": "17480564313767011848875183619179664059858752895043417664367993734102179996257921392224634695412815670220721022213295334170253258440868060952876440280879911732631073449968206958687212249807456692692816395134340974500751072766410928060421292595909295149637318570836082812309128976423214250572417374501156729071975522886661038443386033616735062408362932613032135267191798644453623771193188493014930256755130684199358801813466928293683674209568004485188307430062046187425487821500477325733790496571692104657713780790955180816245041603256163336216900095894970575089815873990141497487287128399153996714004988735732320303001",
                  "2": "40796336165801440263680261465793985573758041485856070613879737488745751665070325309545304020805043001557561222927041069949694480974418535572368246741181646728186760389551270471575502911258993278227048334660272502259193206389894344012105745017155900740810904205587953412559380133164836927377489931387499515611256201602091185832395790671055331450757264210260545461582405556630174927071848107911803685589178169185221327144466012796666445861981667281161496077783387450540202309705396479289960477852326725837634909128804584395723865224385127078119967937594368788958502553806557126162130142717253505944323000840882864518917",
                  "3": "38358396632521880375080672231870196338518854554998351452205198358830533589459105266914152390477479641717006721330628836114048928042182407521440123130955131852056352953819502534731848707711317967208573692832281320987702196993729915114593276325074492106562405862340968731234890441539097250510203340023088269740265209019978801626799334278843927010460680958731758439339584339090145815015664333348049330419665675132753336594832599617212842114804634383096979139863028731724406105351046029260525142370038660025844443325130440452014801759732008486353644916141216264672949875686180013655069074726679860183265067185814795013999",
                  "DELTA": "9331569841581599883183674108101491719247375612455178367548795893096328074474024601174475493339639441074526656805974245604425430545490509540167756102290175247765029708791972230093802155308338429875278153094543498755894492514811757974846519736095958426718799059986991681701910004004191944517520663085858053479290801479968829406777342148989323292957340506736646374560215325379513852781668861187340921359612132291585301004142352948247623764729388750847220756437435243280635195324799897650030096202393685369705077224454433193499527977323020790178113645371319131246509399591991471998843704323462016768146086367971593136472"
                },
                "predicate": {
                  "attr_name": "age",
                  "p_type": "GE",
                  "value": 18
                }
              }
            ]
          },
          "non_revoc_proof": null
        }
      ],
      "aggregated_proof": {
        "c_hash": "1035245309192644425562066147635506401037986178702979123322560529606209875468",
        "c_list": [
          [
            1,
           ...
            88
          ]
        ]
      }
    },
    "requested_proof": {
      "revealed_attrs": {
        "24c0839e-ea4f-4399-b76e-b1aca178d3ac": {
          "sub_proof_index": 0,
          "raw": "Alice Smith",
          "encoded": "62816810226936654797779705000772968058283780124309077049681734835796332704413"
        }
      },
      "self_attested_attrs": {},
      "unrevealed_attrs": {},
      "predicates": {
        "1c5d0a4a-f614-4eb3-87d2-3cf2de58e640": {
          "sub_proof_index": 0
        }
      }
    },
    "identifiers": [
      {
        "schema_id": "UDyb3ptnV9wwi95no6MHvU:2:person schema:0.0.1",
        "cred_def_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:13:default",
        "rev_reg_id": null,
        "timestamp": null
      }
    ]
  }
}
```
Note: Verification of the proof is done by Agent1 without any interaction from Agent2.

# Proofs made up of multiple credentials
First we create 2 schemas, and the corresponding credential definitions with the desired attributes:
Schema 1:
```
{
  "schema_version": "0.0.1",
  "attributes": [
    "age"
  ],
  "schema_name": "age schema"
}
```
Response:
```
{
  "schema_id": "UDyb3ptnV9wwi95no6MHvU:2:age schema:0.0.1"
}
```
Credential definition response:
```
{
  "credential_definition_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:15:default"
}
```
Schema 2:
```
{
  "schema_version": "0.0.1",
  "attributes": [
    "name"
  ],
  "schema_name": "name schema"
}
```
Response:
```
{
  "schema_id": "UDyb3ptnV9wwi95no6MHvU:2:name schema:0.0.1"
}
```
Credential definition response:
```
{
  "credential_definition_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:16:default"
}
```
Then from Agent1 we issue the following credentials and we follow the steps described above to save them on Agen2:
```
{
  "credential_values": {"age": "20"},
  "credential_definition_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:15:default",
  "connection_id": "8af9397f-2e95-4ba1-a905-0f045e09823f"
}
```
```
{
  "credential_values": {"name": "Alice"},
  "credential_definition_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:16:default",
  "connection_id": "8af9397f-2e95-4ba1-a905-0f045e09823f"
}
```
From Agent1 we send a presentation exchange request with the following data:
```
{
  "requested_predicates": [
    {
      "name": "age",
      "p_type": ">=",
      "restrictions": [
        {"cred_def_id" : "UDyb3ptnV9wwi95no6MHvU:3:CL:15:default"}
      ],
      "p_value":  18
    }
  ],
  "requested_attributes": [
    {
      "name": "name",
      "restrictions": [
        {"cred_def_id" : "UDyb3ptnV9wwi95no6MHvU:3:CL:16:default"}
      ]
    }
  ],
  "name": "Proof of Age",
  "version": "1.0",
  "connection_id": "8af9397f-2e95-4ba1-a905-0f045e09823f"
}
```
On Agent2, the received presentation_exchange will look like this:
```
{
    "presentation_request": {
        "name": "Proof of Age",
        "version": "1.0",
        "nonce": "78716091191176403942869019233694504772",
        "requested_attributes": {
            "0c7f1f21-ab7c-4c3b-ab51-9fa999df1095": {
                "name": "name",
                "restrictions": [
                    {
                        "cred_def_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:16:default"
                    }
                ]
            }
        },
        "requested_predicates": {
            "2d64df62-82de-4dbb-bd7b-7f1224b8a74f": {
                "name": "age",
                "p_type": ">=",
                "restrictions": [
                    {
                        "cred_def_id": "UDyb3ptnV9wwi95no6MHvU:3:CL:15:default"
                    }
                ],
                "p_value": 18
            }
        }
    },
    "updated_at": "2019-08-16 11:36:23.578211Z",
    "thread_id": "3e682b5d-0a56-4cd5-9045-c4d7f338c938",
    "connection_id": "6d8340d9-1e61-4637-8572-13f6adfc2a59",
    "presentation_exchange_id": "9a8528ea-bf00-4ff6-899f-ec171671e17e",
    "state": "request_received",
    "created_at": "2019-08-16 11:36:23.578211Z",
    "initiator": "external"
}
```
Following the flow described above, Agent2 will respond with the following presentation which will then be received and verified on Agent1:
```
{
    "self_attested_attributes": {},
    "requested_attributes": {
        "0c7f1f21-ab7c-4c3b-ab51-9fa999df1095": {
            "cred_id": "d78f8ba2-7971-4155-866b-ba98e4842642",
            "revealed": true
        }
    },
    "requested_predicates": {
        "2d64df62-82de-4dbb-bd7b-7f1224b8a74f": {
            "cred_id": "be682fe5-8fe0-44dd-9399-0cc57d503b31"
        }
    }
}
```
